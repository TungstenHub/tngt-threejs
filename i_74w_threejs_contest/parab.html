<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title></title>
		<style>
			body { margin: 0; height: 100%; overflow: hidden}
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>

		<div id='newWindow'></div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/92/three.min.js"></script>
		<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.2/dat.gui.min.js"></script>
		<script>
			// INIT //
			document.getElementById( 'newWindow' ).href += window.location.hash;
			var gui = new dat.GUI();
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 55, window.innerWidth / window.innerHeight, 0.1, 5000 );
			camera.position.y= -30;
			var renderer = new THREE.WebGLRenderer( { antialias: true } );
			//renderer.setPixelRatio( window.devicePixelRatio );
			renderer.setSize( window.innerWidth, window.innerHeight );
			//renderer.setClearColor( 0x000000, 1 );
			document.body.appendChild( renderer.domElement );
			
			// ORBIT //
			var orbit = new THREE.OrbitControls( camera, renderer.domElement );
			
			// LIGHTS //
			var lights = [];
			lights[ 0 ] = new THREE.PointLight( 0xffffff, 1, 0 );
			lights[ 1 ] = new THREE.PointLight( 0xffffff, 1, 0 );
			lights[ 2 ] = new THREE.PointLight( 0xffffff, 1, 0 );
			lights[ 0 ].position.set( 0, 200, 0 );
			lights[ 1 ].position.set( 100, 200, 100 );
			lights[ 2 ].position.set( - 100, - 200, - 100 );
			var light = new THREE.AmbientLight( 0x404040 ); 
			scene.add( light );
			scene.add( lights[ 0 ] );
			scene.add( lights[ 1 ] );
			scene.add( lights[ 2 ] );
			// OBJECT //
			surfaceData = {
				u: 6,
				v: 6
			};
			
			surfaceParamGenerator = function (data) {
				
				return function ( u, v, optionalTarget ) {
					var result = optionalTarget || new THREE.Vector3();
					u -= 0.51;
					u *= data.u;
					v -= 0.51;
					v *= data.v;
					//u *= 1;
					//v *= 1;
		
					x = u;
					y = v;
					z= (v**2+u**2)**(1/2);
		
					return result.set( x, y, z );
		
				}
			}
	
			var geometry = new THREE.ParametricGeometry( surfaceParamGenerator(surfaceData), 5, 5 );
			var material = new THREE.MeshLambertMaterial( {
				color: '#6600cc', 
				transparent: true,
				opacity: 0.8,
				side: THREE.DoubleSide,
				flatShading: true,
				//wireframe:true
			} );
			var wire_material = new THREE.LineDashedMaterial( {
				color: 0xffffff,
				transparent: true,
				opacity: 0.5
			} );
			var obj = new THREE.Mesh( geometry, material );
			obj.add( new THREE.LineSegments(new THREE.WireframeGeometry(geometry), wire_material) );
			obj.castShadow=true;
			function updateSurface() {
				geometry = new THREE.ParametricGeometry( surfaceParamGenerator(surfaceData), 20, 20 );
				obj.geometry.dispose();
				obj.geometry = geometry;
				obj.children[0] = new THREE.LineSegments(new THREE.WireframeGeometry(geometry), wire_material);
			}
			updateSurface();
			
			// GUI //
			var folder = gui.addFolder( 'Parameter Range' );
			folder.add( surfaceData, 'u', 0, 12 ).onChange( updateSurface );
			folder.add( surfaceData, 'v', 0, 12).onChange( updateSurface );
			



			var axes= new THREE.AxesHelper(16);

			scene.add(axes);

			// END //
			scene.add( obj );


			var PlaneGeometry= new THREE.PlaneGeometry(10,10,20);
			var PlaneMaterial= new THREE.MeshLambertMaterial({color:0xcccccc});

			var plane=new THREE.Mesh(PlaneGeometry,PlaneMaterial); 
			plane.receiveShadow=true;


			scene.add(plane);
			
			var render = function () {
				requestAnimationFrame( render );
				renderer.render( scene, camera );
			};
			window.addEventListener( 'resize', function () {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.shadowMap.enabled=true;
			}, false );
			render();
		</script>
	</body>
</html>
