<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title></title>
		<style>
			body { margin: 0; height: 100%; overflow: hidden}
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>

		<div id='newWindow'></div>

		<script src="https://unpkg.com/three@0.123.0/build/three.min.js"></script>
		<script src="https://unpkg.com/three@0.123.0/examples/js/controls/OrbitControls.js"></script>
		<script src="../utils/regular_polyhedra.js"></script>
    <script src="../utils/spherical_strip.js"></script>
		<script>

			// INIT //

			document.getElementById( 'newWindow' ).href += window.location.hash;

			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 15, window.innerWidth / window.innerHeight, 0.1, 50 );
			camera.position.z = -10;

			var renderer = new THREE.WebGLRenderer( { antialias: true } );
			renderer.setPixelRatio( window.devicePixelRatio );
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.setClearColor( 0x000000, 1 );
			document.body.appendChild( renderer.domElement );
			
			// ORBIT //

			var orbit = new THREE.OrbitControls( camera, renderer.domElement );
			
			// LIGHTS //

			var lights = [];
			lights[ 0 ] = new THREE.PointLight( 0xffffff, 1, 0 );
			lights[ 1 ] = new THREE.PointLight( 0xffffff, 1, 0 );
			lights[ 2 ] = new THREE.PointLight( 0xffffff, 1, 0 );

			lights[ 0 ].position.set( 0, 200, 0 );
			lights[ 1 ].position.set( 100, 200, 100 );
			lights[ 2 ].position.set( - 100, - 200, - 100 );

			var light = new THREE.AmbientLight( 0x404040 ); 

			scene.add( light );
			scene.add( lights[ 0 ] );
			scene.add( lights[ 1 ] );
			scene.add( lights[ 2 ] );

			// OBJECT //

			var singleGeometry = new THREE.Geometry();

			const data = polyh_data.oct;

			for (let e of data.edges) {
				singleGeometry.merge(
					spherical_strip(
						new THREE.Vector3(...data.verts[e[0]]),
						new THREE.Vector3(...data.verts[e[1]])
					)
				)
			}

			var material = new THREE.MeshPhongMaterial( {
				color: '#222222', 
				side: THREE.DoubleSide,
			} );

			var wire = new THREE.Mesh( singleGeometry, material );

      const sph_geom = new THREE.SphereGeometry( 0.999, 64, 64 );
      const sph_mat = new THREE.MeshPhongMaterial( {
        color: '#E91E63', 
        transparent: true,
        opacity: 0.7,
      } );
      const sphere = new THREE.Mesh( sph_geom, sph_mat );
			
			// END //

      const rot = [(Math.random()-0.5)*0.005,(Math.random()-0.5)*0.005,(Math.random()-0.5)*0.005];

			scene.add( wire );
      scene.add( sphere );
			
			var render = function () {

        wire.rotation.x += rot[0];
        wire.rotation.y += rot[1];
        wire.rotation.z += rot[2];

				requestAnimationFrame( render );

				renderer.render( scene, camera );

			};

			window.addEventListener( 'resize', function () {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}, false );

			render();
		</script>
	</body>
</html>